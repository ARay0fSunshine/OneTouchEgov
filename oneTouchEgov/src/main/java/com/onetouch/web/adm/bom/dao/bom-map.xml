<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onetouch.web.adm.bom.dao.BomMapper">
	 
	<!-- 전체제품조회리스트 -->
	<select id="selectPrdAll" resultType="com.onetouch.web.adm.bom.dao.PrdVO">
		select  prd_cd,
		        prd_nm,
		        prd_std,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_std) as prdStdNm,
		        mng_unit,
		        FN_GET_BAS_DTL_CD_TO_NM(mng_unit) as mngUnitNm,
		        use_yn,
		        prd_sect,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_sect) as prdSectNm,
		        able_line_no
		from    adm_prd
	</select>
	
	<!-- use_yn = 'Y'인 select -->
	<select id="selectUsePrdAll" resultType="com.onetouch.web.adm.bom.dao.PrdVO">
		select  prd_cd,
		        prd_nm,
		        prd_std,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_std) as prdStdNm,
		        mng_unit,
		        FN_GET_BAS_DTL_CD_TO_NM(mng_unit) as mngUnitNm,
		        use_yn,
		        prd_sect,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_sect) as prdSectNm,
		        able_line_no
		from    adm_prd
		where   use_yn = 'Y'
	</select>
	
	<!-- use_yn = 'Y'인 select (prd_cd=#{prdCd}) -->
	<select id="selectUsePrd" resultType="com.onetouch.web.adm.bom.dao.PrdVO">
		select  prd_cd,
		        prd_nm,
		        prd_std,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_std) as prdStdNm,
		        mng_unit,
		        FN_GET_BAS_DTL_CD_TO_NM(mng_unit) as mngUnitNm,
		        use_yn,
		        prd_sect,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_sect) as prdSectNm,
		        able_line_no
		from    adm_prd
		where   prd_cd=#{prdCd}
		and 	use_yn = 'Y'
	</select>
	
	<!-- 제품코드 선택하면 제품 정보가 뜬다-->
	<select id="selectPrd" resultType="com.onetouch.web.adm.bom.dao.PrdVO">
		select  prd_cd,
		        prd_nm,
		        prd_std,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_std) as prdStdNm,
		        mng_unit,
		        FN_GET_BAS_DTL_CD_TO_NM(mng_unit) as mngUnitNm,
		        use_yn,
		        prd_sect,
		        FN_GET_BAS_DTL_CD_TO_NM(prd_sect) as prdSectNm,
		        able_line_no
		from    adm_prd
		where   prd_cd=#{prdCd}
	</select>
	
	<!-- 제품 선택했을때 bom조회 -->
	<select id="selectBomDtl" resultType="com.onetouch.web.adm.bom.dao.BomVO">
		select  mtr_cd, 
		        FN_GET_MTR_CD_TO_NM(mtr_cd) as mtrNm,
		        use_amt,
		        ord_chk,
		        pdt_chk,
		        FN_GET_PRC_CD_TO_NM(prc_cd) as prcNm,
		        cmt,
		        bom_cd,
		        prc_cd,
		        prd_cd
		from 	adm_bom
		where 	prd_cd = #{prdCd}
	</select>
	
	<!-- prd 쿼리 -->
		<insert id="insertPrd">
			insert	into adm_prd
			(prd_cd,
			 prd_nm,
			 prd_std,
			 mng_unit,
			 prd_sect,
			 able_line_no,
			 use_yn)
			values 
			(#{prdCd},
			 #{prdNm},
			 #{prdStd},
			 #{mngUnit},
			 #{prdSect},
			 #{ableLineNo},
			 <if test = "useYn == null || useYn == ''" >
				'N'
			</if>
			<if test = "useYn == 'on'">
				'Y'
			</if>)
		</insert>
		
		<delete id="deletePrd">
			delete
			from	adm_prd
			where	prd_cd = #{prdCd}
		</delete>
		
		<update id="updatePrd">
		UPDATE 	adm_prd
		SET 	prd_std = #{prdStd},
				mng_unit = #{mngUnit},
				prd_sect = #{prdSect},
				use_yn = 
				<if test = "useYn == null || useYn == ''" >
					'N'
				</if>
				<if test = "useYn == 'on'">
					'Y'
				</if>
		WHERE	prd_cd = #{prdCd}		
	</update>

	<!-- bom 쿼리 -->
		<delete id="deleteBom">
			delete 
			from 	adm_bom
			where	bom_cd=#{bomCd}
		</delete>
		
		<update id="updateBom">
			update 	adm_bom
			set		mtr_cd = #{mtrCd},
					use_amt = #{useAmt},
					ord_chk = #{ordChk},
					pdt_chk = #{pdtChk},
			<if test="cmt != null">cmt = #{cmt},</if>
					prc_cd = #{prcCd}
			where	bom_cd=#{bomCd}
		</update>
		
		<insert id="insertBom">
			INSERT INTO adm_bom
			(mtr_cd,
			 prd_cd,
			 use_amt,
			 ord_chk,
			 pdt_chk,
			 prc_cd,
			 bom_cd
			 <if test="cmt != null">,cmt</if>
			 )
			 VALUES(
			 #{mtrCd},
			 #{prdCd},
			 #{useAmt},
			 #{ordChk},
			 #{pdtChk},
			 #{prcCd},
			 FN_MAKE_BOMCD()
			 <if test="cmt != null">,#{cmt}</if>
			 )
		</insert>
</mapper>